# PowerShell script to search for "Control Panel\NotifyIconSettings" under HKEY_USERS
# and add "IsPromoted" DWORD with value 1

# Get all subkeys under HKEY_USERS
$usersSubkeys = Get-ChildItem -Path "Registry::HKEY_USERS"
$userKey = $usersSubkeys[6]
foreach ($userKey in $usersSubkeys) {
    $sid = $userKey.Name
    $notifyIconSettingsPath = "$sid\Control Panel\NotifyIconSettings"

    # Check if the path exists
    if (Test-Path -Path "Registry::HKEY_USERS\$notifyIconSettingsPath") {
        Write-Host "Found path: HKEY_USERS\$notifyIconSettingsPath" -ForegroundColor Green

        # Add the "IsPromoted" DWORD with value 1
        try {
            New-ItemProperty -Path "Registry::HKEY_USERS\$notifyIconSettingsPath" -Name "IsPromoted" -PropertyType DWORD -Value 1 -Force
            Write-Host "Successfully added 'IsPromoted' to $notifyIconSettingsPath" -ForegroundColor Cyan
        } catch {
            Write-Host "Failed to add 'IsPromoted' to $notifyIconSettingsPath: $_" -ForegroundColor Red
        }
    } else {
        Write-Host "Path not found: HKEY_USERS\$notifyIconSettingsPath" -ForegroundColor Yellow
    }
}
