# Get all subkeys under HKEY_USERS
$usersSubkeys = Get-ChildItem -Path "Registry::HKEY_USERS"

foreach ($userKey in $usersSubkeys) {
    $sid = $userKey.Name
    $notifyIconSettingsPath = "$sid\Control Panel\NotifyIconSettings"

    # Check if the path exists
    if (Test-Path -Path "Registry::HKEY_USERS\$notifyIconSettingsPath") {
        Write-Host "Found path: HKEY_USERS\$notifyIconSettingsPath" -ForegroundColor Green

        # Get all subkeys under NotifyIconSettings
        $childKeys = Get-ChildItem -Path "Registry::HKEY_USERS\$notifyIconSettingsPath"

        foreach ($childKey in $childKeys) {
            $childKeyPath = $childKey.PSPath

            # Add the "IsPromoted" DWORD with value 1
            try {
                New-ItemProperty -Path $childKeyPath -Name "IsPromoted" -PropertyType DWORD -Value 1 -Force
                Write-Host "Successfully added 'IsPromoted' to $childKeyPath" -ForegroundColor Cyan
            } catch {
                Write-Host "Failed to add 'IsPromoted' to " -ForegroundColor Red
            }
        }
    } else {
        Write-Host "Path not found: HKEY_USERS\$notifyIconSettingsPath" -ForegroundColor Yellow
    }
}
