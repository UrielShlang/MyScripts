Get-ChildItem ^"HKCU:\Control Panel\NotifyIconSettings^" ^| ForEach-Object { Set-ItemProperty -Path $_.PSPath -Name ^"IsPromoted^" -Type DWORD -Value 1 } > "%SCRIPT_PATH%"

# PowerShell script to search for "Control Panel\NotifyIconSettings" under HKEY_USERS
# and add "IsPromoted" DWORD with value 1

# Get all subkeys under HKEY_USERS
$usersSubkeys = Get-ChildItem -Path "HKU:\"

foreach ($userKey in $usersSubkeys) {
    $notifyIconSettingsPath = "$($userKey.PSChildName)\\Control Panel\\NotifyIconSettings"

    # Check if the path exists
    if (Test-Path -Path "HKU:\$notifyIconSettingsPath") {
        Write-Host "Found path: HKU:\$notifyIconSettingsPath" -ForegroundColor Green

        # Add the "IsPromoted" DWORD with value 1
        try {
            New-ItemProperty -Path "HKU:\$notifyIconSettingsPath" -Name "IsPromoted" -PropertyType DWORD -Value 1 -Force
            Write-Host "Successfully added 'IsPromoted' to $notifyIconSettingsPath" -ForegroundColor Cyan
        } catch {
            Write-Host "Failed to add 'IsPromoted' to $notifyIconSettingsPath: $_" -ForegroundColor Red
        }
    } else {
        Write-Host "Path not found: HKU:\$notifyIconSettingsPath" -ForegroundColor Yellow
    }
}
